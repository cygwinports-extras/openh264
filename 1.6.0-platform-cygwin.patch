--- origsrc/openh264-1.6.0/Makefile	2016-07-11 03:17:38.000000000 -0500
+++ src/openh264-1.6.0/Makefile	2017-03-30 09:30:40.553416100 -0500
@@ -27,6 +27,7 @@ OBJ=o
 DESTDIR=
 LIBDIR_NAME=lib
 SHAREDLIB_DIR=$(PREFIX)/lib
+SHAREDLIBPREFIX=lib
 PROJECT_NAME=openh264
 MODULE_NAME=gmpopenh264
 GMP_API_BRANCH=Firefox39
@@ -79,7 +80,7 @@ all: libraries binaries
 
 include $(SRC_PATH)build/platform-$(OS).mk
 
-MODULE := $(LIBPREFIX)$(MODULE_NAME).$(SHAREDLIBSUFFIX)
+MODULE := $(SHAREDLIBPREFIX)$(MODULE_NAME)$(SHAREDLIBSUFFIX)
 
 CFLAGS += -DGENERATED_VERSION_HEADER
 LDFLAGS +=
@@ -220,10 +221,10 @@ libraries: $(LIBPREFIX)$(PROJECT_NAME).$
 
 # No point in building dylib for ios
 ifneq (ios, $(OS))
-libraries: $(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIX)
+libraries: $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(SHAREDLIBSUFFIX)
 endif
 
-LIBRARIES += $(LIBPREFIX)$(PROJECT_NAME).$(LIBSUFFIX) $(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIXVER)
+LIBRARIES += $(LIBPREFIX)$(PROJECT_NAME).$(LIBSUFFIX) $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(SHAREDLIBSUFFIXVER)
 
 $(LIBPREFIX)$(PROJECT_NAME).$(LIBSUFFIX): $(ENCODER_OBJS) $(DECODER_OBJS) $(PROCESSING_OBJS) $(COMMON_OBJS)
 	$(QUIET)rm -f $@
@@ -233,25 +234,25 @@ ifeq (True, $(PROCESS_FILES))
 	strip $(STRIP_FLAGS) $@ -o $@
 endif
 
-$(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIXVER): $(ENCODER_OBJS) $(DECODER_OBJS) $(PROCESSING_OBJS) $(COMMON_OBJS)
+$(SHAREDLIBPREFIX)$(PROJECT_NAME)$(SHAREDLIBSUFFIXVER): $(ENCODER_OBJS) $(DECODER_OBJS) $(PROCESSING_OBJS) $(COMMON_OBJS)
 	$(QUIET)rm -f $@
 	$(QUIET_CXX)$(CXX) $(SHARED) $(CXX_LINK_O) $+ $(LDFLAGS) $(SHLDFLAGS)
 ifeq (True, $(PROCESS_FILES))
-	cp $@ $(LIBPREFIX)$(PROJECT_NAME)$(DEBUGSYMBOLS_TAG).$(SHAREDLIBSUFFIXVER)
+	cp $@ $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(DEBUGSYMBOLS_TAG)$(SHAREDLIBSUFFIXVER)
 	strip $(STRIP_FLAGS) $@ -o $@
 endif
 
 ifneq ($(SHAREDLIBSUFFIXVER),$(SHAREDLIBSUFFIX))
-$(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIX): $(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIXVER)
+$(SHAREDLIBPREFIX)$(PROJECT_NAME)$(SHAREDLIBSUFFIX): $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(SHAREDLIBSUFFIXVER)
 	$(QUIET)ln -sfn $+ $@
 ifeq (True, $(PROCESS_FILES))
-	$(QUIET)ln -sfn $(LIBPREFIX)$(PROJECT_NAME)$(DEBUGSYMBOLS_TAG).$(SHAREDLIBSUFFIXVER) $(LIBPREFIX)$(PROJECT_NAME)$(DEBUGSYMBOLS_TAG).$(SHAREDLIBSUFFIX)
+	$(QUIET)ln -sfn $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(DEBUGSYMBOLS_TAG)$(SHAREDLIBSUFFIXVER) $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(DEBUGSYMBOLS_TAG)$(SHAREDLIBSUFFIX)
 endif
 endif
 
 ifeq ($(HAVE_GMP_API),Yes)
 plugin: $(MODULE)
-LIBRARIES += $(LIBPREFIX)$(MODULE_NAME).$(SHAREDLIBSUFFIXVER)
+LIBRARIES += $(SHAREDLIBPREFIX)$(MODULE_NAME)$(SHAREDLIBSUFFIXVER)
 else
 plugin:
 	@echo "./gmp-api: No such file or directory."
@@ -261,19 +262,19 @@ endif
 echo-plugin-name:
 	@echo $(MODULE)
 
-$(LIBPREFIX)$(MODULE_NAME).$(SHAREDLIBSUFFIXVER): $(MODULE_OBJS) $(ENCODER_OBJS) $(DECODER_OBJS) $(PROCESSING_OBJS) $(COMMON_OBJS)
+$(SHAREDLIBPREFIX)$(MODULE_NAME)$(SHAREDLIBSUFFIXVER): $(MODULE_OBJS) $(ENCODER_OBJS) $(DECODER_OBJS) $(PROCESSING_OBJS) $(COMMON_OBJS)
 	$(QUIET)rm -f $@
 	$(QUIET_CXX)$(CXX) $(SHARED) $(CXX_LINK_O) $+ $(LDFLAGS) $(SHLDFLAGS) $(MODULE_LDFLAGS)
 ifeq (True, $(PROCESS_FILES))
-	cp $@ $(LIBPREFIX)$(MODULE_NAME)$(DEBUGSYMBOLS_TAG).$(SHAREDLIBSUFFIXVER)
+	cp $@ $(SHAREDLIBPREFIX)$(MODULE_NAME)$(DEBUGSYMBOLS_TAG)$(SHAREDLIBSUFFIXVER)
 	strip $(STRIP_FLAGS) $@ -o $@
 endif
 
 ifneq ($(SHAREDLIBSUFFIXVER),$(SHAREDLIBSUFFIX))
-$(MODULE): $(LIBPREFIX)$(MODULE_NAME).$(SHAREDLIBSUFFIXVER)
+$(MODULE): $(SHAREDLIBPREFIX)$(MODULE_NAME)$(SHAREDLIBSUFFIXVER)
 	$(QUIET)ln -sfn $+ $@
 ifeq (True, $(PROCESS_FILES))
-	$(QUIET)ln -sfn $(LIBPREFIX)$(MODULE_NAME)$(DEBUGSYMBOLS_TAG).$(SHAREDLIBSUFFIXVER) $(LIBPREFIX)$(MODULE_NAME)$(DEBUGSYMBOLS_TAG).$(SHAREDLIBSUFFIX)
+	$(QUIET)ln -sfn $(SHAREDLIBPREFIX)$(MODULE_NAME)$(DEBUGSYMBOLS_TAG)$(SHAREDLIBSUFFIXVER) $(LIBPREFIX)$(MODULE_NAME)$(DEBUGSYMBOLS_TAG)$(SHAREDLIBSUFFIX)
 endif
 endif
 
@@ -295,11 +296,11 @@ install-static: install-static-lib $(PRO
 	mkdir -p $(DESTDIR)$(PREFIX)/$(LIBDIR_NAME)/pkgconfig
 	install -m 644 $(PROJECT_NAME)-static.pc $(DESTDIR)$(PREFIX)/$(LIBDIR_NAME)/pkgconfig/$(PROJECT_NAME).pc
 
-install-shared: $(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIX) install-headers $(PROJECT_NAME).pc
+install-shared: $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(SHAREDLIBSUFFIX) install-headers $(PROJECT_NAME).pc
 	mkdir -p $(DESTDIR)$(SHAREDLIB_DIR)
-	install -m 755 $(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIXVER) $(DESTDIR)$(SHAREDLIB_DIR)
+	install -m 755 $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(SHAREDLIBSUFFIXVER) $(DESTDIR)$(SHAREDLIB_DIR)
 	if [ "$(SHAREDLIBSUFFIXVER)" != "$(SHAREDLIBSUFFIX)" ]; then \
-		cp -a $(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIX) $(DESTDIR)$(SHAREDLIB_DIR); \
+		cp -a $(SHAREDLIBPREFIX)$(PROJECT_NAME)$(SHAREDLIBSUFFIX) $(DESTDIR)$(SHAREDLIB_DIR); \
 	fi
 	mkdir -p $(DESTDIR)$(PREFIX)/$(LIBDIR_NAME)/pkgconfig
 	install -m 644 $(PROJECT_NAME).pc $(DESTDIR)$(PREFIX)/$(LIBDIR_NAME)/pkgconfig
@@ -327,8 +328,8 @@ $(LIBPREFIX)ut.$(LIBSUFFIX): $(DECODER_U
 	$(QUIET_AR)$(AR) $(AR_OPTS) $+
 
 
-LIBRARIES +=$(LIBPREFIX)ut.$(SHAREDLIBSUFFIX)
-$(LIBPREFIX)ut.$(SHAREDLIBSUFFIX): $(DECODER_UNITTEST_OBJS) $(ENCODER_UNITTEST_OBJS) $(PROCESSING_UNITTEST_OBJS) $(API_TEST_OBJS) $(COMMON_UNITTEST_OBJS) $(CODEC_UNITTEST_DEPS)
+LIBRARIES +=$(SHAREDLIBPREFIX)ut$(SHAREDLIBSUFFIX)
+$(SHAREDLIBPREFIX)ut$(SHAREDLIBSUFFIX): $(DECODER_UNITTEST_OBJS) $(ENCODER_UNITTEST_OBJS) $(PROCESSING_UNITTEST_OBJS) $(API_TEST_OBJS) $(COMMON_UNITTEST_OBJS) $(CODEC_UNITTEST_DEPS)
 	$(QUIET)rm -f $@
 	$(QUIET_CXX)$(CXX) $(SHARED) $(CXX_LINK_O) $+ $(LDFLAGS) $(UTSHLDFLAGS) $(CODEC_UNITTEST_LDFLAGS)
 
@@ -349,7 +350,7 @@ else
 ifeq (ios,$(OS))
 codec_unittest$(EXEEXT): $(LIBPREFIX)ut.$(LIBSUFFIX) $(LIBPREFIX)gtest.$(LIBSUFFIX) $(LIBPREFIX)$(PROJECT_NAME).$(LIBSUFFIX)
 else
-codec_unittest$(EXEEXT): $(LIBPREFIX)ut.$(SHAREDLIBSUFFIX)
+codec_unittest$(EXEEXT): $(SHAREDLIBPREFIX)ut$(SHAREDLIBSUFFIX)
 endif
 
 ifeq (android,$(OS))
--- origsrc/openh264-1.6.0/build/msvc-common.mk	2016-07-11 03:17:38.000000000 -0500
+++ src/openh264-1.6.0/build/msvc-common.mk	2017-03-30 09:32:53.740487800 -0500
@@ -36,7 +36,7 @@ LIBPREFIX=
 EXEEXT=.exe
 OBJ=obj
 SHAREDLIB_DIR = $(PREFIX)/bin
-SHAREDLIBSUFFIX=dll
+SHAREDLIBSUFFIX=.dll
 SHAREDLIBSUFFIXVER=$(SHAREDLIBSUFFIX)
 SHARED=-LD
 EXTRA_LIBRARY=$(PROJECT_NAME)_dll.lib
--- origsrc/openh264-1.6.0/build/platform-android.mk	2016-07-11 03:17:38.000000000 -0500
+++ src/openh264-1.6.0/build/platform-android.mk	2017-03-30 09:15:46.379916600 -0500
@@ -1,6 +1,6 @@
 ARCH = arm
 include $(SRC_PATH)build/arch.mk
-SHAREDLIBSUFFIX = so
+SHAREDLIBSUFFIX = .so
 # Android APK/JARs expect libraries to be unversioned
 SHAREDLIBSUFFIXVER=$(SHAREDLIBSUFFIX)
 SHLDFLAGS =
--- origsrc/openh264-1.6.0/build/platform-bsd.mk	2016-07-11 03:17:38.000000000 -0500
+++ src/openh264-1.6.0/build/platform-bsd.mk	2017-03-30 09:15:46.379916600 -0500
@@ -1,5 +1,5 @@
 include $(SRC_PATH)build/arch.mk
-SHAREDLIBSUFFIX = so
+SHAREDLIBSUFFIX = .so
 SHAREDLIBSUFFIXVER=$(SHAREDLIBSUFFIX).$(SHAREDLIBVERSION)
 SHLDFLAGS = -Wl,-soname,$(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIXVER)
 CFLAGS += -fPIC
--- origsrc/openh264-1.6.0/build/platform-cygwin_nt.mk	1969-12-31 18:00:00.000000000 -0600
+++ src/openh264-1.6.0/build/platform-cygwin_nt.mk	2017-03-30 09:15:46.379916600 -0500
@@ -0,0 +1,17 @@
+include $(SRC_PATH)build/x86-common.mk
+SHAREDLIB_DIR = $(PREFIX)/bin
+SHAREDLIBPREFIX = cyg
+SHAREDLIBSUFFIX = -$(SHAREDLIBVERSION).dll
+SHAREDLIBSUFFIXVER=$(SHAREDLIBSUFFIX)
+EXTRA_LIBRARY=$(LIBPREFIX)$(PROJECT_NAME).dll.a
+SHLDFLAGS = -Wl,--out-implib,$(EXTRA_LIBRARY)
+CFLAGS += -MMD -MP
+LDFLAGS +=
+ifeq ($(ARCH), x86_64)
+ASMFLAGS += -f win64
+ASMFLAGS_PLATFORM = -DWIN64
+else
+ASMFLAGS += -f win32 -DPREFIX
+endif
+EXEEXT = .exe
+
--- origsrc/openh264-1.6.0/build/platform-darwin.mk	2016-07-11 03:17:38.000000000 -0500
+++ src/openh264-1.6.0/build/platform-darwin.mk	2017-03-30 09:15:46.400056200 -0500
@@ -1,6 +1,6 @@
 include $(SRC_PATH)build/arch.mk
 SHAREDLIB_DIR = $(PREFIX)/lib
-SHAREDLIBSUFFIX = dylib
+SHAREDLIBSUFFIX = .dylib
 SHAREDLIBSUFFIXVER=$(SHAREDLIBVERSION).$(SHAREDLIBSUFFIX)
 SHLDFLAGS = -dynamiclib -twolevel_namespace -undefined dynamic_lookup \
 	-fno-common -headerpad_max_install_names -install_name \
--- origsrc/openh264-1.6.0/build/platform-linux.mk	2016-07-11 03:17:38.000000000 -0500
+++ src/openh264-1.6.0/build/platform-linux.mk	2017-03-30 09:15:46.401557000 -0500
@@ -1,5 +1,5 @@
 include $(SRC_PATH)build/arch.mk
-SHAREDLIBSUFFIX = so
+SHAREDLIBSUFFIX = .so
 SHAREDLIBSUFFIXVER=$(SHAREDLIBSUFFIX).$(SHAREDLIBVERSION)
 SHLDFLAGS = -Wl,-soname,$(LIBPREFIX)$(PROJECT_NAME).$(SHAREDLIBSUFFIXVER)
 CFLAGS += -Wall -fno-strict-aliasing -fPIC -MMD -MP
--- origsrc/openh264-1.6.0/build/platform-mingw_nt.mk	2016-07-11 03:17:38.000000000 -0500
+++ src/openh264-1.6.0/build/platform-mingw_nt.mk	2017-03-30 09:15:46.401557000 -0500
@@ -1,6 +1,6 @@
 include $(SRC_PATH)build/x86-common.mk
 SHAREDLIB_DIR = $(PREFIX)/bin
-SHAREDLIBSUFFIX = dll
+SHAREDLIBSUFFIX = .dll
 SHAREDLIBSUFFIXVER=$(SHAREDLIBSUFFIX)
 EXTRA_LIBRARY=$(LIBPREFIX)$(PROJECT_NAME).dll.a
 SHLDFLAGS = -Wl,--out-implib,$(EXTRA_LIBRARY)
--- origsrc/openh264-1.6.0/codec/common/src/WelsThreadLib.cpp	2016-07-11 03:17:38.000000000 -0500
+++ src/openh264-1.6.0/codec/common/src/WelsThreadLib.cpp	2017-03-30 09:15:46.401557000 -0500
@@ -46,7 +46,11 @@
 #include <sched.h>
 #elif !defined(_WIN32)
 #include <sys/types.h>
+#ifdef __CYGWIN__
+#include <sys/sysinfo.h>
+#else
 #include <sys/sysctl.h>
+#endif
 #include <sys/param.h>
 #include <unistd.h>
 #ifdef __APPLE__
@@ -544,6 +548,8 @@ WELS_THREAD_ERROR_CODE    WelsQueryLogic
 #if defined(__OpenBSD__)
   int scname[] = { CTL_HW, HW_NCPU };
   if (sysctl (scname, 2, &pInfo->ProcessorCount, &len, NULL, 0) == -1)
+#elif defined(__CYGWIN__)
+  if (!(pInfo->ProcessorCount = get_nprocs()))
 #else
   if (sysctlbyname (HW_NCPU_NAME, &pInfo->ProcessorCount, &len, NULL, 0) == -1)
 #endif
